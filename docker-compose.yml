services:
  monolith:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ldap-crypto-monolith
    # This maps the internal Nginx port (8000) to your host
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      # These variables can be defined in .env or passed from the shell
      - LDAP_HOST=${LDAP_HOST}
      - LDAP_PORT=${LDAP_PORT}
      - LDAP_USE_SSL=${LDAP_USE_SSL:-false}
      - BASE_DN=${BASE_DN}
      - ADMIN_USER=${ADMIN_USER}
      - ADMIN_PW=${ADMIN_PW}
      - JWT_SECRET=${JWT_SECRET}
    restart: always
    volumes:
      # Optional: Map certs if the backend needs to validate the CA
      - ./certs:/etc/ldap/certs:ro
    # This ensures your logs are visible in the console
    tty: true

networks:
  ldap_network:
    external: true